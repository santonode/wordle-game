<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wurdle</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <h1>Wurdle</h1>
    {% if game_blocked %}
        <p id="blocked-message">{{ message }}</p>
        <a href="/wordlist">View Word List</a>
        <a href="/stats">View Stats</a>
        <button id="replay-button" onclick="requestReplay()">Replay</button>
    {% else %}
        <div id="game-board"></div>
        <div id="input-area">
            <input type="text" id="guess-input" maxlength="5" placeholder="Enter 5-letter word">
            <button onclick="submitGuess()">Submit</button>
            <button onclick="toggleHardMode()">Toggle Hard Mode</button>
            <p id="hard-mode-status">Hard Mode: Off</p>
            <a href="/wordlist">View Word List</a>
            <a href="/stats">View Stats</a>
        </div>
        <p id="message"></p>
        <textarea id="share-text" readonly></textarea>
        <button onclick="copyShareText()">Share Results</button>
    {% endif %}

    <script>
        let guesses = [];

        async function submitGuess() {
            const input = document.getElementById('guess-input')?.value.toUpperCase();
            if (!input || input.length !== 5) {
                alert('Please enter a 5-letter word.');
                return;
            }

            const response = await fetch('/guess', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ guess: input })
            });
            const data = await response.json();

            if (data.error) {
                alert(data.error);
                return;
            }

            guesses.push({ guess: data.guess, result: data.result });
            renderBoard();
            document.getElementById('guess-input').value = '';

            if (data.message) {
                document.getElementById('message').textContent = data.message;
                document.getElementById('share-text').value = data.share_text;
            }
        }

        async function toggleHardMode() {
            const response = await fetch('/toggle_hard_mode', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const data = await response.json();
            if (data.error) {
                alert(data.error);
                return;
            }
            document.getElementById('hard-mode-status').textContent = `Hard Mode: ${data.hard_mode ? 'On' : 'Off'}`;
        }

        function renderBoard() {
            const board = document.getElementById('game-board');
            if (!board) return;
            board.innerHTML = '';
            guesses.forEach(g => {
                const row = document.createElement('div');
                row.className = 'row';
                for (let i = 0; i < 5; i++) {
                    const tile = document.createElement('div');
                    tile.className = `tile ${g.result[i] === 'green' ? 'teal' : g.result[i] === 'yellow' ? 'yellow' : 'red'}`;
                    tile.textContent = g.guess[i];
                    row.appendChild(tile);
                }
                board.appendChild(row);
            });
        }

        function copyShareText() {
            const shareText = document.getElementById('share-text');
            if (!shareText) return;
            shareText.select();
            document.execCommand('copy');
            alert('Results copied to clipboard!');
        }

        async function requestReplay() {
            const response = await fetch('/replay', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const data = await response.json();
            if (data.success) {
                // Enable game UI without reload
                document.getElementById('blocked-message').style.display = 'none';
                document.getElementById('replay-button').style.display = 'none';
                document.getElementById('game-board').style.display = 'block';
                document.getElementById('input-area').style.display = 'block';
                document.getElementById('message').style.display = 'block';
                document.getElementById('share-text').style.display = 'block';
                guesses = []; // Reset guesses for new game
                renderBoard();
                alert('Replay enabled! Start your new game.');
            } else {
                alert('Unable to replay at this time.');
            }
        }

        document.getElementById('guess-input')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') submitGuess();
        });
    </script>
</body>
</html>
